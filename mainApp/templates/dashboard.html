{% load static %}
{% load notifications_tags %}
<!DOCTYPE html>
<html>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    {% comment %} <script type="text/javascript" src="{% static 'chart.js' %}"></script> {% endcomment %}
    <script type="text/javascript">
        function my_notification(data) {
            for (var i=0; i < data.unread_list.length; i++) {
                msg = data.unread_list[i];
                console.log(msg);
            }
        }
    </script>
    <body>
        <div style="border:solid black;">
            {% notifications_unread %}
            {% live_notify_list %}
            <script src="{% static 'notifications/notify.js' %}" type="text/javascript"></script>
            {% register_notify_callbacks callbacks='my_notification,fill_notification_list,fill_notification_badge' %}
        </div>
        <h2>Temperatura: {{tempMedia}}</h2>
        <h2>Umidade: {{umidadeMedia}}</h2>
        {% if erroLeitura %}
            <h4>Falha na conexão com a API</h4>
        {% else %}
            {% for i in ultLeituras %}
                <h4>Sensor: {{i.sensorId}}, temp: {{i.temperatura}}, umidade: {{i.umidade}}, {{i.data}}</h4>
            {% endfor %}
        {% endif %}
        <div id="chart_div"></div>
        <script>
            google.charts.load('current', {'packages': ['line', 'corechart']});
            google.charts.setOnLoadCallback(drawChart);

            function drawChart() {

                var chartDiv = document.getElementById('chart_div');

                var data = new google.visualization.DataTable();
                data.addColumn('date', 'Data-Hora');
                data.addColumn('number', "Temperatura");
                data.addColumn('number', "Umidade");

                data.addRows([
                    {% for i in leituras %}
                        [new Date(Date.parse("{{i.data|date:"c"}}")), {{i.temperatura}}, {{i.umidade}}],
                    {% endfor %}
                ]);

                var materialOptions = {
                    chart: {
                        title: 'Temperatura e Umidade no período x a y'
                    },
                    width: 900,
                    height: 500,
                    series: {
                        // Gives each series an axis name that matches the Y-axis below.
                        0: {
                            axis: 'Temperatura'
                        },
                        1: {
                            axis: 'Umidade'
                        }
                    },
                    axes: {
                    // Adds labels to each axis; they don't have to match the axis names.
                        y: {
                            Temperatura: {
                                label: 'Temperatura (Celsius)'
                            },
                            Umidade: {
                                label: 'Umidade Relativa (%)'
                            }
                        }
                    }
                };

                function drawMaterialChart() {
                    var materialChart = new google.charts.Line(chartDiv);
                    materialChart.draw(data, materialOptions);
                }

                drawMaterialChart();
            }
        </script>
    </body>
</html>